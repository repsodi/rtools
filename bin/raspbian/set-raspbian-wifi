#!/bin/sh

. $(dirname $0)/../var

file1=/boot/config.txt

file2=/etc/modprobe.d/8192cu.conf

file3=/etc/wpa_supplicant/wpa_supplicant.conf
config3=${HOME}/opt/${tool_name}/conf/${os_name}/wpa_supplicant.conf
psk=$1

if [ ! -f ${file1}.ori ]; then
    echo "Creating ${file1}.ori..."
    sudo cp -p ${file1} ${file1}.ori
else
    echo "${file1}.ori exists."
fi
sudo cp -p ${file1}.ori ${file1}
sudo sh -c "echo >> ${file1}"
sudo sh -c "echo # Disable WiFi >> ${file1}"
sudo sh -c "echo #dtoverlay=pi3-disable-wifi >> ${file1}"
sudo vim ${file1}
echo "${file1} has been generated."
sleep 5

sudo sh -c "echo options 8192cu rtw_power_mgnt=0 > ${file2}"
echo "${file2} has been generated."
sleep 5

if [ ! -f ${file3}.ori ]; then
    echo "Creating ${file3}.ori..."
    sudo cp -p ${file3} ${file3}.ori
else
    echo "${file3}.ori exists."
fi
sudo sh -c "cat ${file3}.ori ${config3} > ${file3}"
if [ ! -z $psk ]; then
    sudo sed -i "s/\*\*\*\*\*\*\*\*/$psk/g" ${file3}
fi
echo "${file3} has been generated."
sleep 5

ls -l ${file1}*
ls -l ${file2}*
ls -l ${file3}*
