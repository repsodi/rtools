#!/bin/bash

# 2023-08-14

if [ -z "${1}" ] || [ -z "${2}" ]; then
    echo "Usage: get-vsc [version] [stable|insider]"
    exit 0
fi

download()
{
    application=${1}
    profiles=${2}
    for profile in ${profiles}
    do
        if [ $? != 0 ]; then
            exit 1
        fi
        echo "#"
        echo "# Downloading: ${application} ${type} ${profile}"
        echo "#"
        wget --content-disposition ${url_base}/${version}/${profile}/${type} -P "${application}"
    done
}

vsc="Visual Studio Code"
url_base="https://update.code.visualstudio.com"
version=${1}
profiles_vsc="win32-x64-user win32-user win32-arm64-user
              win32-x64 win32 win32-arm64
              win32-x64-archive win32-archive win32-arm64-archive
              linux-deb-x64 linux-deb-armhf linux-deb-arm64
              linux-rpm-x64 linux-rpm-armhf linux-rpm-arm64
              linux-x64 linux-armhf linux-arm64 darwin
              darwin-arm64 darwin-universal"
# TODO: cli-alpine-x64 cli-linux-armhf cli-alpine-arm64 -> cli-linux-x64 cli-linux-armhf cli-linux-arm64
profiles_vsc_cli="cli-win32-x64 cli-win32-ia32 cli-win32-arm64
                  cli-alpine-x64 cli-linux-armhf cli-alpine-arm64
                  cli-darwin-x64 cli-darwin-arm64"
type=${2}

if [ ${type} == "insider" ]; then
    vsc="${vsc} - Insiders"
    version="${version}-insider"
fi

application="${vsc} ${version}"
download "${application}" "${profiles_vsc}"

application="${vsc} CLI ${version}"
download "${application}" "${profiles_vsc_cli}"
